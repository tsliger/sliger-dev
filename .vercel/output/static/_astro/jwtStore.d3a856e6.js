let c=(e,u,l,s)=>(e.events=e.events||{},e.events[l+10]||(e.events[l+10]=s(t=>{e.events[l].reduceRight((i,f)=>(f(i),i),{shared:{},...t})})),e.events[l]=e.events[l]||[],e.events[l].push(u),()=>{let t=e.events[l],i=t.indexOf(u);t.splice(i,1),t.length||(delete e.events[l],e.events[l+10](),delete e.events[l+10])}),a=1e3,N=(e,u)=>c(e,s=>{let t=u(s);t&&e.events[6].push(t)},5,s=>{let t=e.listen;e.listen=(...f)=>(!e.lc&&!e.active&&(e.active=!0,s()),t(...f));let i=e.off;return e.events[6]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let f of e.events[6])f();e.events[6]=[]}},a)},()=>{e.listen=t,e.off=i}}),r=[],U=(e,u)=>{let l,s=[],t={lc:0,l:u||0,value:e,set(i){t.value=i,t.notify()},get(){return t.lc||t.listen(()=>{})(),t.value},notify(i){l=s;let f=!r.length;for(let n=0;n<l.length;n+=2)r.push(l[n],t.value,i,l[n+1]);if(f){for(let n=0;n<r.length;n+=4){let d=!1;for(let o=n+7;o<r.length;o+=4)if(r[o]<r[n+3]){d=!0;break}d?r.push(r[n],r[n+1],r[n+2],r[n+3]):r[n](r[n+1],r[n+2])}r.length=0}},listen(i,f){return s===l&&(s=s.slice()),t.lc=s.push(i,f||t.l)/2,()=>{s===l&&(s=s.slice());let n=s.indexOf(i);~n&&(s.splice(n,2),t.lc--,t.lc||t.off())}},subscribe(i,f){let n=t.listen(i,f);return i(t.value),n},off(){}};return t},E=e=>e,v={},T={addEventListener(){},removeEventListener(){}};function g(){try{return typeof localStorage<"u"}catch{return!1}}g()&&(v=localStorage);let O={addEventListener(e,u){window.addEventListener("storage",u)},removeEventListener(e,u){window.removeEventListener("storage",u)}};typeof window<"u"&&(T=O);function h(e,u=void 0,l={}){let s=l.encode||E,t=l.decode||E,i=U(u),f=i.set;i.set=d=>{typeof d>"u"?delete v[e]:v[e]=s(d),f(d)};function n(d){d.key===e?d.newValue===null?f(void 0):f(t(d.newValue)):v[e]||f(void 0)}return N(i,()=>{if(i.set(v[e]?t(v[e]):u),l.listen!==!1)return T.addEventListener(e,n),()=>{T.removeEventListener(e,n)}}),i}const L=h(void 0);export{L as j};
